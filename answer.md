使用说明
====
本项目由C语言编写。

准备输入数据：
```bash
$ gzip -d solexa*.fa.gz
$ cat solexa_100_170_2.fa >> solexa_100_170_1.fa
```

编译前，在源码中修改k的值：
```c
#define k0 50
```

使用支持ISO/ANSI C99的编译器进行编译：
```bash
$ gcc -std=c99 -Wall -O3 source.c -o k-mer
```

运行程序：
```bash
$ ./k-mer solexa_100_170_1.fa
```

实现概述
====
索引建立
----
A、C、G、T分别转换为对应的数值00、01、10、11，每个碱基对应两个二进制位，方便储存。
k-mer序列按照Little-Endian顺序记录在一个整数里。
例如，`TTTCC`这个5-mer可以转换为`0b0101111111 = 0x17F`。

程序开始运行时，顺序读入输入文件，在内存中用链表存储所有可能的k-mer序列。
每个链表记录同一类别的k-mer，链表的头结点位置记录在一个指针数组里，以k-mer对应的整数为下标。
假设`k=5`，以测试输入的`(1, 1)`和`(5, 24)`处出现过的`TTTCC`为例，具体存储方式如下：

```c
...
type[0x17E(GTTCC)] -> ...
type[0x17F(TTTCC)] -> (5, 24) -> (1, 0) -> NULL
type[0x180(AAAGC)] -> ...
...
```

如图所示，由于题目没有要求，为了建立索引时间尽量快，链表的新节点直接加在了链表的头部。
假设DNA的条数为`n`、每条DNA中的碱基数为`m`。
程序所要储存的部分包括一个`4^k`大小的指针数组和`n * (m-k)`个链表节点。
其中，每个链表节点需要包括指向下一个节点的指针及本节点的k-mer在DNA序列中的位置。
综上所述，此法建立索引的时间复杂度为`O(n*m)`，空间复杂度为`O(n*m + 2^k)`。

索引查询
----
用上述方法将欲查询的k-mer序列转换为整数后，从上述指针数组的对应下标处开始遍历链表即可。
这一过程的平均时间复杂度为`O(n*m / 2^k)`。

性能分析
----
在上述方法中，索引建立的时间只与DNA序列的数据规模有关，查询的时间复杂度随`k`递减，但索引所占空间随`k`以指数速度增长。
当`m=100`，`n=1000000`时，`k`值大小与所占内存空间的大小如下所示：

 k | 32位PC | 64位PC
---|--------|-------
<=9|   <1MB |  <2MB
10 |    1MB |   2MB
11 |    4MB |   8MB
12 |   16MB |  32MB
13 |   64MB | 128MB
14 |  256MB | 512MB
15 |    1GB |   2GB
16 |    4GB |   8GB
17 |    8GB |  16GB

这使得`k`的取值只能达到`k=16`或`k=17`左右的范围。

为改进算法，考虑到题目中所给`n`和`m`的数据规模，会发现：
当`k=14`时，假设每种14-mer出现的概率均等，则每种14-mer的平均数量仅为：
`1000000 * (100-14+1) / 4^14 = 0.3241`。
由此可见，当`k>13`时，每种k-mer出现的平均数量已不足一个，指针数组中的`2^k`个指针很多为空值。

为了节省空间，不妨将前13个碱基的序列（如`AAAAACCCCCGGGGG`和`AAAAACCCCCGGGTT`）储存在同一个链表中。
这样，无论`k`如何取值，索引占用的空间都将不多于`k=13`时所占的空间，`2^k`这一部分的空间复杂度下降为常数阶，可以允许`k`在1~100范围内任意取值。

采用此法后，由于前13个碱基相同的k-mer亦可能在13位之后有差异，造成误判，需要另行读取输入文件中的完整序列与查询值比对。
由于输入文件中奇数行内容长度不等，无法像结构化文件一样，快速计算出指定行数相对文件起始位置的偏移量。
因此在储存超过13位的k-mer序列位置时，同时记录下该序列的偏移量，避免查询时

测试数据
----
ThinkPad X220t / Core i7 2620M @ 2.70 GHz / 4GB 内存
Clang 3.6.0 @ Windows Server 2012 R2 Datacenter x86-64

 k | 索引用时 | 查询用时 | 占用内存
---|-------|------|------
 5 | 28.6s | 1.3s | 733MB
 7 | 28.7s | 0.1s | 717MB
 9 | 28.6s | 0.0s | 720MB
12 | 32.7s | 0.0s | 743MB
15 | 38.1s | 0.0s |1494MB
30 | 39.6s | 0.0s |1489MB

Raspberry Pi 2B / Broadcom BCM2836 @ 900 MHz / 1GB 内存
GCC 4.9.2 @ Debian 7.0, Linux Kernel 3.18 x86

 k | 索引用时 | 查询用时 | 占用内存
---|-------|-------|------
 5 | 1.32s | 0.16s | 734MB
 7 | 1.32s | 0.02s | 719MB
 9 | 1.52s | 0.00s | 705MB
12 | 2.77s | 0.00s | 745MB
15 | 3.34s | 0.00s | 914MB
30 | 3.50s | 0.00s | 799MB
